"use client";

import { useState, useRef, useEffect, useCallback } from "react";
import _, { random } from "lodash";

// 初期表示＆ループで追加する条文の配列
const TERM_CANDIDATES = [
  "本規約における「かき氷」とは、当サイトがそう定義するものに限られます。",
  "利用者は、画面上のピクセルが正方形であることを常に意識するものとします。",
  "スクロールバーの現在位置は、利用者の人生における現在地を必ずしも反映しません。",
  "当サイトの背景色は、予告なく利用者の気分に寄り添う色に変更されることがあります。",
  "第一条から第四条までの内容は、第五条によってその効力を失います。",
  "第五条は存在しません。",
  "利用者は、ブラウザのキャッシュを自身の記憶と混同してはなりません。",
  "当サイトを閲覧中、キーボードの「F5」キーを押すことは、運命への挑戦とみなされます。",
  "注文確定ボタンは、押されるまでその存在を確定しません。",
  "「イチゴ味」とは、イチゴの概念を表現したものであり、実際のイチゴ味を保証するものではありません。",
  "利用者は、1分間に60回以上まばたきをしないよう努力する義務を負います。",
  "当サイトのフォントは、読めそうで読めない絶妙な可読性を維持します。",
  "「はい」または「YES」という選択肢は、質問の意図を肯定するものとは限りません。",
  "利用者は、モニターから発せられる光が粒子であり、かつ波であることを受け入れます。",
  "サーバーとの通信は、時折、量子トンネル効果を介して行われる場合があります。",
  "シロップの粘度は、その日の気圧によってリアルタイムに変動します。",
  "本規約のいずれかの条項が無効とされた場合、他の全ての条項も無効となります。",
  "前項の規定は、この条項によって無効とされます。",
  "利用者のマウスポインターの軌道は、当サイトの品質向上のため記録されます。",
  "記録された軌道は、現代アートとして販売される可能性があります。",
  "氷の結晶構造は、利用者の精神状態を反映して変化します。",
  "「トッピング」の選択は、不可逆的な未来の選択と同義です。",
  "当サイトのソースコードを読むことは、深淵を覗く行為とみなされます。",
  "深淵を覗くとき、深淵もまたこちらを覗いています。",
  "サイトの表示が崩れた場合、それは仕様です。",
  "利用者は、円周率が割り切れないことを悲しんではなりません。",
  "注文したかき氷は、三次元空間に存在するとは限りません。",
  "配送先の住所は、必ずしも物理的な場所を指定するものではありません。",
  "当サイトは、Internet Explorer 6での閲覧を推奨します。",
  "推奨はしますが、表示を保証するものではありません。",
  "利用者は、自身の思考が現実を創造する可能性を否定しないものとします。",
  "支払い方法は、現物支給（氷）を原則とします。",
  "領収書は、古代ルーン文字で発行される場合があります。",
  "解読の義務は、利用者が負うものとします。",
  "かき氷の温度は、絶対零度を超えるとは断定できません。",
  "利用者は、当サイトの利用を通じて、無意味の意味について考察するものとします。",
  "本規約は、利用者の夢の中に直接表示されることがあります。",
  "その際の既読判定は、夢の中の利用者の同意に基づきます。",
  "ページの読み込みが遅いのは、サーバーが瞑想しているためです。",
  "サーバーの悟りを妨げる行為（リロード連打など）は固く禁じます。",
  "「宇治金時」の「時」は、時間そのものを指し示します。",
  "これを注文した利用者は、時間の流れを操作する権利を得る可能性があります。",
  "権利の行使によって生じた時空の歪みに対し、当サイトは一切の責任を負いません。",
  "利用者は、クリック音が隣人に聞こえないよう配慮しなければなりません。",
  "404エラーページは、当サイトにおける隠しステージへの入り口です。",
  "隠しステージの存在は確認されていません。",
  "かき氷の器は、クラインの壺である場合があります。",
  "その場合、かき氷を食べ終えることは論理的に不可能です。",
  "本規約は、下から上にスクロールすることで、全く異なる意味を持つよう設計されています。",
  "その設計は、まだ実装されていません。",
  "利用者は、自身の影と対話する時間を設けることが推奨されます。",
  "対話の内容は、当サイトのサーバーに自動的に送信されます。",
  "送信された内容は、次世代のかき氷フレーバー開発に利用されます。",
  "「影味」のかき氷が登場した場合、それは前項に起因します。",
  "当サイトのドメイン名は、気まぐれで変更されます。",
  "変更の通知は、伝書鳩によって行われるものとします。",
  "利用者は、伝書鳩を受け取るための環境を整備する義務を負います。",
  "かき氷を待つ間、利用者は無であることについて考える必要があります。",
  "考えることをやめた時、かき氷は完成します。",
  "Cookieの使用に同意することは、魂の一部を当サイトに預けることと同義です。",
  "預けられた魂は、サイトの表示速度向上のための生贄とされます。",
  "「利用者の声」は、すべて当サイトのスタッフによって創作されたものです。",
  "この条項を読んだ利用者は、この秘密を保持しなければなりません。",
  "秘密を漏洩した場合、ペナルティとしてかき氷の量が半分になります。",
  "量の半分は、体積ではなく次元によって定義されます。",
  "利用者は、当サイトが現実ではない可能性を常に考慮に入れるものとします。",
  "注文後、確認メールは送信されません。テレパシーでご確認ください。",
  "テレパシーの受信能力は、利用者の責任において開発するものとします。",
  "「限定フレーバー」は、誰にも注文されないことによってその限定性を保ちます。",
  "これを注文する行為は、矛盾への挑戦です。",
  "サイト上で使用される画像は、すべてAIによって生成された架空のかき氷です。",
  "実在のかき氷とは一切関係ありません。",
  "スクロールする行為は、地球の自転に微細な影響を与えます。",
  "これによる天変地異について、当サイトは関知しません。",
  "利用者は、本規約を音読することが義務付けられています。",
  "小声での音読は、同意とみなされません。",
  "本規約の文章量は、常に増え続ける可能性があります。",
  "すべての条項を読了することは、物理的に不可能かもしれません。",
  "それでもなお、利用者は読了したとみなされます。",
  "ログインパスワードは、毎秒変更されます。",
  "正しいパスワードは、利用者の心の中に直接表示されます。",
  "心の声に耳を澄ませてください。",
  "かき氷のシロップは、情報伝達媒体としての側面を持ちます。",
  "シロップを摂取することで、宇宙の真理を垣間見る可能性があります。",
  "垣間見た結果、発狂しても当サイトは責任を負いません。",
  "本サイトは、利用者に対し、無償の愛を提供します。",
  "愛の定義は、当サイトが一方的に決定します。",
  "返品・交換は受け付けません。時間は不可逆です。",
  "当サイトの存在自体が、壮大な社会実験の一部です。",
  "利用者は、被験者として適切な行動を心がけてください。",
  "「よくある質問」のページには、質問しか書かれていません。",
  "答えは、利用者が自ら見つけ出すものです。",
  "決済処理中、画面に表示されるプログレスバーは、何ものも進捗していません。",
  "あれはデザインです。",
  "本規約は、フィクションであり、実在の人物・団体・かき氷とは一切関係ありません。",
  "ただし、同意した場合はこの限りではありません。",
  "当サイトのfaviconは、404ピクセル×404ピクセルの透明な画像です。",
  "見えないものを見る努力が、利用者には求められます。",
  "本規約の最終条項は、常にその一つ前の条項によって参照されます。",
  "この規約に同意したという事実は、同意した瞬間から忘れなければなりません。",
  "利用者はSNSで猫の画像を見かけたら、3秒以内に「いいね」をしなければならない。",
  "犬の動画を視聴した利用者は、その日は善行を一つ積むことを義務付けられる。",
  "食事の写真を投稿する際、利用者は料理に対して感謝の言葉を心の中で述べなければならない。",
  "午前3時に当サービスを利用する場合、利用者は白湯を一杯飲むものとする。",
  "利用者は、キーボードのCapsLockキーを神聖なものとして扱い、みだりに使用してはならない。",
  "天気予報が外れたとしても、利用者は予報士を責めるのではなく、空の気まぐれとして受け入れなければならない。",
  "利用者は、自身の影が伸びているのを見かけたら、少しだけ速足で歩くよう努めるものとする。",
  "イヤホンで音楽を聴いている際、片方だけ外す行為は、音楽への裏切りとみなされる。",
  "充電が20%未満の状態でサービスを利用する場合、利用者はデバイスに対して応援の言葉をかけなければならない。",
  "利用者は、円周率を少なくとも小数点以下5桁まで暗唱できることを推奨される。",
  "虹を見かけた利用者は、その日のうちに誰かに小さな親切をしなければならない。",
  "利用者は、部屋の観葉植物に週に一度、最近の出来事を報告する義務を負う。",
  "電車の窓から外を眺める際、利用者は少なくとも一度は物思いにふける表情をしなければならない。",
  "利用者は、自身が使用するパスワードの最後の文字を、誰にも明かしてはならない。",
  "SNSのアイコンを変更した場合、利用者は古いアイコンに対して感謝の意を表するものとする。",
  "購入した本を読まずに積んでおく行為（積読）は、3冊までを上限とする。",
  "利用者は、靴下を左右揃えて脱ぎ、洗濯機に入れることを誓約する。",
  "夜空に月が見えない日でも、利用者は月の存在を信じ続けなければならない。",
  "自動販売機でお釣りが多く出てきた場合、利用者はその差額分を後日寄付することが望ましい。",
  "利用者は、スマートフォンの画面についた指紋を、1日に3回以上拭き取ることを義務付けられる。",
  "エスカレーターに乗る際、利用者は歩かずに静止し、その機械の動きに身を委ねなければならない。",
  "利用者は、文章の末尾に句読点を付けることを、文明の証として尊重する。",
  "SNSの「おすすめ」に表示された友人を、無視してはならない。少なくともプロフィールを一度は確認するものとする。",
  "利用者は、ハトが平和の象徴であることを認め、威嚇する行為を禁ずる。",
  "プリンターが紙詰まりを起こした場合、利用者は機械を叱責せず、冷静に対処しなければならない。",
  "利用者は、お茶を飲む際、湯呑の正面を避けて口をつけるという伝統を尊重するよう努める。",
  "寝癖がついたままサービスを利用する場合、利用者はその髪型を「本日のアート」として受け入れるものとする。",
  "利用者は、スーパーのレジで丁寧な言葉遣いをすることを、社会貢献の一環とみなす。",
  "他人のSNS投稿に対し、3回連続で「笑」のみの返信をすることを禁ずる。",
  "利用者は、自身の星座占いの結果を、少なくともその日の午前中まで信じなければならない。",
  "エレベーターの「閉」ボタンを連打する行為は、心の余裕のなさと判断される。",
  "利用者は、季節の変わり目に感じる一抹の寂しさを、人生の深みとして肯定しなければならない。",
  "ティッシュペーパーは、一枚ずつ引き出すことを原則とする。",
  "利用者は、横断歩道の白い部分のみを踏んで渡るという遊び心を、生涯持ち続けるものとする。",
  "他人のペットの写真をSNSで見かけた場合、「かわいい」以外の語彙で褒める努力をしなければならない。",
  "利用者は、電化製品の取扱説明書を、一度は最後まで読むことを誓う。",
  "使い終わったトイレットペーパーの芯を交換する行為は、次なる使用者への思いやりである。",
  "利用者は、自身のタイピング速度が、思考速度を超えないように調整しなければならない。",
  "SNSのプロフィールに記載する趣味は、少なくとも3ヶ月以上継続しているものに限る。",
  "利用者は、流れ星に願い事をする際、3回唱えるというルールを遵守する。",
  "シャンプーとリンスは、必ず同じブランドのもので揃えることが推奨される。",
  "利用者は、映画のエンドロールを最後まで鑑賞することを、制作者への敬意として義務付けられる。",
  "SNS上で議論が発生した場合、利用者は絵文字を使って場の空気を和らげる役割を担う。",
  "利用者は、道端の草花の名前を、年に一つ以上覚えるよう努めるものとする。",
  "冷蔵庫のドアを不必要に長く開けておく行為は、電力資源への冒涜とみなす。",
  "利用者は、漢字の書き順が、その文字の美しさを構成する要素であることを理解する。",
  "友人が新しい髪型にしたことをSNSで報告した場合、変化に気づき、それを褒めるコメントをしなければならない。",
  "利用者は、自身の部屋にある椅子の数を、常に正確に把握しておくものとする。",
  "割り箸を割る際、綺麗に割れなかったとしても、それを受け入れなければならない。",
  "利用者は、虫が苦手であっても、益虫の存在価値を認めなければならない。",
  "SNSで「飯テロ」投稿を行う場合、閲覧者の空腹を煽りすぎないよう配慮するものとする。",
  "利用者は、ボールペンのインクを最後まで使い切ることに、達成感を感じなければならない。",
  "目玉焼きにかける調味料について、利用者は自身の信条を他者に強要してはならない。",
  "利用者は、自身のPCのデスクトップ画面を、月に一度は整理整頓するものとする。",
  "他人の誕生日を祝うSNS投稿は、午前0時ちょうどを狙うのではなく、相手の生活時間を考慮して行う。",
  "利用者は、洋服のタグが肌に当たって不快な場合、速やかにそれを切断する権利を有する。",
  "傘を干す際は、完全に乾くまで家の中に入れてはならない。",
  "利用者は、地球が丸いという事実を、サービス利用中も忘れてはならない。",
  "SNSのストーリー機能には、24時間で消える儚さがあることを理解し、投稿しなければならない。",
  "利用者は、電車の乗り換え案内アプリの結果を、盲信してはならない。",
  "休日にアラームをかけずに目覚めるという行為は、最高の贅沢の一つとして定義される。",
  "利用者は、自身が最後に見た夢の内容を、誰か一人に話すまで覚えておく努力をするものとする。",
  "オンライン会議で自分が話していない時、利用者は頷きによって参加の意思を示さなければならない。",
  "利用者は、お気に入りの曲が、いつかお気に入りでなくなる可能性を受け入れなければならない。",
  "他人がシェアした音楽を聴く際は、少なくとも30秒以上再生することを礼儀とする。",
  "利用者は、新しいガジェットを購入した場合、その箱を最低1週間は保管しなければならない。",
  "「草」というネットスラングを使用する場合、一回の発言につき3つまでを上限とする。",
  "利用者は、空のペットボトルを分別する際、ラベルを剥がすことを義務付けられる。",
  "ゲームで敗北した際、コントローラーを投げる行為は固く禁ずる。",
  "利用者は、サービス利用中にあくびをする場合、手で口を覆うものとする。",
  "SNSで旅行の報告をする場合、最も楽しかった瞬間の写真を一枚目に設定しなければならない。",
  "利用者は、ラーメンのスープを飲むか飲まないかについて、自身の健康と向き合い決定する。",
  "電車の優先席付近では、スマートフォンの使用が他の乗客の不安を煽らないよう配慮する。",
  "利用者は、セミの鳴き声を夏の風物詩として受け入れ、騒音と断じてはならない。",
  "友人から勧められた映画や本は、1年以内に鑑賞・読了し、感想を報告しなければならない。",
  "利用者は、自身のエゴサーチを、1日に1回までとする。",
  "コンセントからプラグを抜く際は、コードではなくプラグ本体を持つことを誓約する。",
  "利用者は、自身の好きな食べ物を、嫌いな食べ物より一つ多く言えなければならない。",
  "他人の子供の写真をSNSで見かけた場合、「天使」という言葉の使用は慎重に行うものとする。",
  "利用者は、就寝前にスマートフォンを操作する時間を、30分以内にするよう努める。",
  "「飯テロ」投稿への返信として「お腹すいた」とコメントすることは、投稿者への最高の賛辞である。",
  "利用者は、靴を履く際、靴べらの使用を検討しなければならない。",
  "他人の創作物をSNSで共有する際は、必ず制作者の名前を明記し、敬意を払わなければならない。",
  "利用者は、雲の形から動物や物を連想する能力を、失ってはならない。",
  "温泉たまごの絶妙な固さについて、利用者はこれを科学と芸術の融合として称賛する。",
  "利用者は、チャットで長文を送る際、相手が読みやすいように適度な改行を入れる義務がある。",
  "地図アプリが示す最短ルートが、必ずしも最良のルートではないことを理解する。",
  "利用者は、くしゃみをした人に対し、心の中で「お大事に」と思うものとする。",
  "SNSで自身の専門分野について語る際は、専門用語を多用しすぎないよう配慮する。",
  "利用者は、消しゴムの角から使うのではなく、平らな面から使うことを推奨される。",
  "他人の「いいね」欄を遡る行為は、相手のプライバシーへの配慮を忘れずに行うものとする。",
  "利用者は、この利用規約のいずれかの条項を不合理だと感じた場合、その感情が正しいことを認める。",
  "利用者は、お気に入りのマグカップを一つ定め、それを大切に扱わなければならない。",
  "「全米が泣いた」という映画のキャッチコピーを、鵜呑みにしてはならない。",
  "利用者は、この規約を読了したという事実を、友人や家族に自慢してはならない。",
  "この規約の最後の条項に同意した利用者は、最初の条項の内容を思い出さなければならない。",
];

const INITIAL_TERMS: string[][] = [];
for (let i = 0; i < 10; i++) {
  INITIAL_TERMS.push(_.sampleSize(TERM_CANDIDATES, random(5, 12)));
}

function useTerms() {
  const [terms, setTerms] = useState<string[][]>(INITIAL_TERMS);
  const addTerms = useCallback(() => {
    setTerms((prevTerms) => [
      ...prevTerms,
      ...Array.from({ length: 10 }, () =>
        _.sampleSize(TERM_CANDIDATES, random(5, 12))
      ),
    ]);
  }, []);
  return { terms, addTerms };
}

export default function InfiniteTerms() {
  // 表示する全ての条文を管理するState
  const { terms, addTerms } = useTerms();

  // 監視対象（リストの末尾の要素）への参照
  const sentinelRef = useRef(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        // isIntersectingがtrueなら、監視対象が画面内に入ったということ
        if (entries[0].isIntersecting) {
          addTerms();
        }
      },
      {
        threshold: 0.1,
      }
    );

    // 監視対象の要素(ref.current)を監視開始
    const currentSentinel = sentinelRef.current;
    if (currentSentinel) {
      observer.observe(currentSentinel);
    }

    // クリーンアップ関数：コンポーネントがアンマウントされる時に監視を停止
    return () => {
      if (currentSentinel) {
        observer.unobserve(currentSentinel);
      }
    };
  }, [addTerms]);

  let articleCounter = 1;

  return (
    <div className="w-dvw h-dvh overflow-scroll snap-mandatory snap-y overscroll-contain">
      <div className="space-y-4 text-gray-700">
        {terms.map((chapter, chapterIndex) => (
          <div key={chapterIndex}>
            <span className="font-semibold text-xl snap-start">
              第{articleCounter++}条：
            </span>
            <ol className="list-decimal list-inside mb-2">
              {chapter.map((articleText) => (
                <li
                  key={articleCounter}
                  className="mb-2 text-base leading-relaxed"
                >
                  {articleText}
                </li>
              ))}
            </ol>
          </div>
        ))}
      </div>
      {/* このdivが監視対象 */}
      <div ref={sentinelRef} className="h-100"></div>
    </div>
  );
}
